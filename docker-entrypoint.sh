#!/bin/sh
set -e

echo "üöÄ –ó–∞–ø—É—Å–∫ SK –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."

# –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL..."
until pg_isready -h postgres -p 5432 -U sk_user; do
  echo "PostgreSQL –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤ - –∂–¥–µ–º..."
  sleep 2
done

echo "‚úÖ PostgreSQL –≥–æ—Ç–æ–≤!"

# –ó–∞–ø—É—Å–∫–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ Prisma
echo "üîÑ –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
npx prisma migrate deploy

# Prisma –∫–ª–∏–µ–Ω—Ç —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏
echo "üîß Prisma –∫–ª–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤..."

echo "üéâ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
exec "$@"